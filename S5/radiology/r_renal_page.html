<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ====== SUBJECT PAGE SHORTCUT SETTINGS ====== -->
<script>
/*
    ====== EDIT ONLY THIS BLOCK FOR NEW SUBJECTS ======
    Change these variables for each new subject page.
*/
window.SUBJECT_SETTINGS = {
    PAGE_ID: 'r_renal_mcqs', // Unique localStorage key for this subject
    PAGE_TITLE: 'Qbank - TUCOM -  Radiology', // Title for this subject page
    HOME_LINK: 'Radiology_qbank.html', // Home button link for this subject
};
</script>
<!-- ====== END SHORTCUT SETTINGS ====== -->

<title id="dynamic-title"></title>
<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
/* 2. (Optional) Edit styles for your subject */
body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin-top: 70px;
    padding: 20px;
    background-color: #f4f4f4;
    padding-bottom: 100px;
}
.fixed-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: #17202a;
    color: #fff;
    padding: 10px 0;
    text-align: center;
    z-index: 1000;
    border-bottom: 3px solid #3498db;
}
.fixed-header .made-by-prefix { color: #cccccc; }
.fixed-header a { color: #3498db; text-decoration: none; font-weight: bold; }
.fixed-header a:hover { text-decoration: underline; }
.section {
    margin-bottom: 40px;
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.section-title {
    font-size: 1.8em;
    color: #333;
    margin-bottom: 20px;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
}
.question-container {
    margin-bottom: 25px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    background-color: #fff;
}
.question-container.answered { background-color: #f9f9f9; }
.question-number { font-weight: bold; color: #555; margin-right: 5px; }
.question-text { font-size: 1.1em; color: #333; margin-bottom: 15px; }
ul.options { list-style: none; padding: 0; margin: 0; }
li.option {
    background-color: #f1f1f1;
    margin-bottom: 10px;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    border: 1px solid #ccc;
    position: relative;
    user-select: none;
}
li.option:hover:not(.answered li.option) { background-color: #e0e0e0; }
.question-container.answered li.option:hover { background-color: #f1f1f1; }
li.option.correct:hover { background-color: #d4edda !important; }
li.option.incorrect:hover { background-color: #f8d7da !important; }
li.option.reveal-correct:hover { background-color: #d4edda !important; }
li.option.correct {
    background-color: #d4edda;
    border-color: #c3e6cb;
    color: #155724;
    font-weight: bold;
}
li.option.incorrect {
    background-color: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
    font-weight: bold;
}
.feedback { display: none; font-weight: bold; margin-left: 10px; }
li.option.correct .feedback,
li.option.incorrect .feedback { display: inline; }
.correct .feedback { color: #155724; }
.incorrect .feedback { color: #721c24; }
li.option.reveal-correct {
    background-color: #d4edda !important;
    border-color: #c3e6cb !important;
    color: #155724 !important;
    font-weight: bold !important;
}
.explanation {
    display: none;
    margin-top: 15px;
    padding: 10px;
    background-color: #e9ecef;
    border: 1px solid #ced4da;
    border-radius: 4px;
    color: #495057;
    font-size: 0.95em;
}
.section-score {
    margin-top: 30px;
    font-size: 1.2em;
    font-weight: bold;
    color: #333;
    text-align: center;
    padding: 10px;
    background-color: #e7f3ff;
    border: 1px solid #b3d7ff;
    border-radius: 5px;
}
.bottom-nav-container {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1001;
    display: flex;
    gap: 15px;
}
.main-button {
    background-color: #3498db;
    color: #fff;
    padding: 8px 16px;
    font-size: 0.9em;
    text-decoration: none;
    font-weight: bold;
    border-radius: 25px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
}
.main-button i { margin-right: 8px; }
.main-button:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.25); }
a.main-button:hover { background-color: #2980b9; }
#reset-button { background-color: #e74c3c; }
#reset-button:hover { background-color: #c0392b; }
</style>
</head>
<body>
<div class="fixed-header">
    <span class="made-by-prefix">Made by </span><a href="https://t.me/s/Ali_dicaprio" target="_blank">Ali Hussein</a>
</div>

<!-- 
3. COPY/EDIT: Add your sections and questions below.
   - Each section needs a unique data-section-id (e.g., 1, 2, 3, ...)
   - Each question-container needs a unique data-question-id within its section.
   - Edit section titles and questions for your subject.
-->
   

    <div class="section" data-section-id="2">
    <h2 class="section-title">Renal Radiology</h2>

    <!-- Questions -->
    <div class="question-container" data-question-id="q1">
        <p class="question-text"><span class="question-number">5.</span> Regarding IVU, all true except:</p>
        <ul class="options">
            <li class="option" data-correct="true">A. Nephrogram phase film should be taken 10-15 minutes after injection of contrast media.</li>
            <li class="option" data-correct="false">B. Normal ureter may not be seen completely from proximal to distal because of peristaltic movements.</li>
            <li class="option" data-correct="false">C. Cystogram phase taken after 45 minute to see bladder size, shape or any filling defects.</li>
            <li class="option" data-correct="false">D. Post voiding film taken to see residual urine.</li>
        </ul>
        <p class="explanation">
            Correct answer: A<br>
            a. Correct (this statement is false as required by "all true except"). The nephrogram phase, showing contrast uptake by the renal parenchyma, occurs much earlier, typically within 1-5 minutes after contrast injection. Films at 10-15 minutes show the pyelogram/excretory phase.<br>
            b. Incorrect (this statement is true). Peristalsis in the ureters means they may not be opacified along their entire length simultaneously on a single film.<br>
            c. Incorrect (this statement is true). The cystogram phase occurs as the bladder fills with contrasted urine, typically well visualized by 45 minutes to an hour, allowing assessment of bladder morphology.<br>
            d. Incorrect (this statement is true). A post-voiding film is taken after the patient urinates to assess bladder emptying and quantify residual urine.
        </p>
    </div>

    <div class="question-container" data-question-id="q2">
        <p class="question-text"><span class="question-number">6.</span> Regarding IVU:</p>
        <ul class="options">
            <li class="option" data-correct="false">A. Sensitive for acute obstruction.</li>
            <li class="option" data-correct="true">B. Contraindicated in pregnancy.</li>
            <li class="option" data-correct="false">C. Missing small stone.</li>
            <li class="option" data-correct="false">D. The 30 minute film represent the cystogram.</li>
        </ul>
        <p class="explanation">
            Correct answer: B<br>
            a. Incorrect. While IVU can demonstrate delayed excretion indicative of obstruction, CT is generally more sensitive and provides more information in acute obstruction.<br>
            b. Correct. IVU involves ionizing radiation and is generally contraindicated in pregnancy, especially during the first trimester, due to risks to the fetus.<br>
            c. Incorrect. IVU can miss small urinary stones, particularly if they are radiolucent or overlying bone. (Note: The provided explanation "This is true" is for the statement itself, but it's an incorrect option for the question if B is the primary correct answer).<br>
            d. Incorrect. A 30-minute film shows contrast accumulating in the bladder and is part of the cystographic phase, but the bladder may not be fully distended or optimally evaluated for all cystographic features at exactly 30 minutes in all patients.
        </p>
    </div>

    <div class="question-container" data-question-id="q3">
        <p class="question-text"><span class="question-number">7.</span> Regarding scrotal ultrasound, all wrong except:</p>
        <ul class="options">
            <li class="option" data-correct="false">A. Extravaginal testicular torsion affects infants and is rare.</li>
            <li class="option" data-correct="false">B. In color doppler ultrasound there is markedly increased blood flow.</li>
            <li class="option" data-correct="true">C. Multiple serpiginous tubules >2 mm in diameter superior and posterior to the testis is an ultrasound feature of varicocele.</li>
            <li class="option" data-correct="false">D. Blood flow on doppler ultrasound of varicocele may be increased with coughing, rapid inspiration or valsalva manoeuvre.</li>
        </ul>
        <p class="explanation">
            Correct answer: C<br>
            a. Incorrect (this statement is largely true, but not the "one true" answer). Extravaginal testicular torsion is typical in neonates/infants.<br>
            b. Incorrect (this statement is false). Testicular torsion leads to decreased or absent blood flow.<br>
            c. Correct (this statement is true). This is a classic sonographic description of a varicocele.<br>
            d. Incorrect (this statement is also true, but C is the primary morphological diagnostic feature). Valsalva maneuver or coughing increases intra-abdominal pressure, which can cause or accentuate the dilatation and retrograde flow in a varicocele.<br>
            (Note: Both C and D are true statements. However, C describes the fundamental morphological appearance, while D describes a dynamic characteristic. In "all wrong except" questions, there should ideally be only one correct option. C is a primary diagnostic feature.)
        </p>
    </div>

    <div class="question-container" data-question-id="q4">
        <p class="question-text"><span class="question-number">8.</span> Regarding renal obstruction, all wrong except:</p>
        <ul class="options">
            <li class="option" data-correct="false">A. Grade III represent severe hydronephrosis.</li>
            <li class="option" data-correct="true">B. Ultrasound is an excellent method in detecting obstruction.</li>
            <li class="option" data-correct="false">C. On ultrasound the absence of dilatation exclude obstruction.</li>
            <li class="option" data-correct="false">D. In IVU, the delay in contrast excretion not depends on the degree of obstruction.</li>
        </ul>
        <p class="explanation">
            Correct answer: B<br>
            a. Incorrect (this statement is potentially true depending on grading system, but not the single best true answer). Grade III hydronephrosis generally represents moderate to severe hydronephrosis.<br>
            b. Correct (this statement is true). Ultrasound is excellent at detecting hydronephrosis, the primary indirect sign of urinary tract obstruction.<br>
            c. Incorrect (this statement is false). In very acute obstruction, significant dilatation may not have developed yet.<br>
            d. Incorrect (this statement is false). The degree of delay in contrast excretion is related to the severity of obstruction.
        </p>
    </div>

    <div class="question-container" data-question-id="q5">
        <p class="question-text"><span class="question-number">9.</span> Regarding IVU the most appropriate answer is :</p>
        <ul class="options">
            <li class="option" data-correct="true">A. contraindicated in pregnancy.</li>
            <li class="option" data-correct="false">B. no need for bowel preparation.</li>
            <li class="option" data-correct="false">C. the post voiding (30 minute film) is of value to assess any urinary bladder filling defect</li>
            <li class="option" data-correct="false">D. contrast media is completely safe and never causes allergic reaction.</li>
            <li class="option" data-correct="false">E. contraindicated if the patient had normal renal function.</li>
        </ul>
        <p class="explanation">
            Correct answer: A<br>
            a. Correct. IVU uses ionizing radiation and is generally contraindicated in pregnancy.<br>
            b. Incorrect. Bowel preparation is often required.<br>
            c. Incorrect. The post-voiding film assesses emptying, not primarily filling defects.<br>
            d. Incorrect. Contrast media can cause allergic reactions and nephropathy.<br>
            e. Incorrect. IVU is not contraindicated with normal renal function; impaired function is a concern.
        </p>
    </div>

    <div class="question-container" data-question-id="q6">
        <p class="question-text"><span class="question-number">10.</span> Regarding imaging of renal obstruction the most appropriate answer :</p>
        <ul class="options">
            <li class="option" data-correct="false">A. Grade II represent severe hydronephrosis.</li>
            <li class="option" data-correct="true">B. ultrasound is an excellent method in detecting obstruction.</li>
            <li class="option" data-correct="false">C. on ultrasound the absence of dilatation exclude obstruction.</li>
            <li class="option" data-correct="false">D. in IVU, the delay in contrast excretion not depends on the degree of obstruction.</li>
            <li class="option" data-correct="false">E. all ureteric stones visualized by KUB</li>
        </ul>
        <p class="explanation">
            Correct answer: B<br>
            a. Incorrect. Grade II hydronephrosis typically represents mild to moderate dilatation.<br>
            b. Correct. Ultrasound is excellent for detecting hydronephrosis, an indicator of obstruction.<br>
            c. Incorrect. Acute or low-grade obstruction might not show significant dilatation.<br>
            d. Incorrect. Delay in contrast excretion is proportional to obstruction severity.<br>
            e. Incorrect. KUB only visualizes radiopaque stones.
        </p>
    </div>

    <div class="question-container" data-question-id="q7">
        <p class="question-text"><span class="question-number">11.</span> Regarding renal cell carcinoma the most appropriate answer :</p>
        <ul class="options">
            <li class="option" data-correct="false">A. female predilection with female to male ratio 5:1.</li>
            <li class="option" data-correct="false">B. small tumors are usually hypoechoic by ultrasound.</li>
            <li class="option" data-correct="true">C. CT with IV contrast is the preferred method for staging.</li>
            <li class="option" data-correct="false">D. cystic tumors have thin ,avascular and regular wall on ultrasound</li>
            <li class="option" data-correct="false">E. no hematuria even in large tumour</li>
        </ul>
        <p class="explanation">
            Correct answer: C<br>
            a. Incorrect. RCC has a male predilection.<br>
            b. Incorrect. Small RCCs are often hyperechoic but can be variable.<br>
            c. Correct. Contrast-enhanced CT is gold standard for staging RCC.<br>
            d. Incorrect. This describes a simple benign cyst; cystic RCCs often have complex features.<br>
            e. Incorrect. Hematuria is a common symptom of RCC.
        </p>
    </div>

    <div class="question-container" data-question-id="q8">
        <p class="question-text"><span class="question-number">11.</span> Renal duplication ,all true except:</p>
        <ul class="options">
            <li class="option" data-correct="true">A. In Grade III, complete separation of ureters, each ureter enter the bladder separately.</li>
            <li class="option" data-correct="false">B. Ultrasound findings; Division of renal sinus.</li>
            <li class="option" data-correct="false">C. IVU findings: Large size kidney.</li>
            <li class="option" data-correct="false">D. IVU findings: Local indentation of kidney outline.</li>
        </ul>
        <p class="explanation">
            Correct answer: A<br>
            a. Correct (this statement is false as required by "all true except"). There is no standard "Grade I, II, III" classification for renal duplication itself; this grading is not applicable.<br>
            b. Incorrect (this statement is true). Ultrasound often shows two distinct renal sinuses.<br>
            c. Incorrect (this statement is true). A duplicated kidney is often larger.<br>
            d. Incorrect (this statement can be true). The junction can create an indentation.
        </p>
    </div>

    <div class="question-container" data-question-id="q9">
        <p class="question-text"><span class="question-number">12.</span> Regarding urolithiasis all wrong except:</p>
        <ul class="options">
            <li class="option" data-correct="true">A. ureteric stones are poorly visualized on ultrasound unless they are located within proximal ureter or VUJ.</li>
            <li class="option" data-correct="false">B. IVU is the investigation of choice .</li>
            <li class="option" data-correct="false">C. stones can only be identified on ultrasound if they are greater than 10 mm in size.</li>
            <li class="option" data-correct="false">D. staghorn stones appears on ultrasound as echogenic foci without acoustic shadowing.</li>
            <li class="option" data-correct="false">E. MRI is the imaging modality of choice for visualization of ureteric stone</li>
        </ul>
        <p class="explanation">
            Correct answer: A<br>
            a. Correct (this statement is true). The mid-ureter is often obscured by bowel gas on ultrasound.<br>
            b. Incorrect (this statement is false). Non-contrast CT is the gold standard.<br>
            c. Incorrect (this statement is false). Ultrasound can detect stones smaller than 10 mm.<br>
            d. Incorrect (this statement is false). Staghorn calculi cast prominent acoustic shadowing.<br>
            e. Incorrect (this statement is false). MRI is poor for directly visualizing calcified stones.
        </p>
    </div>

    <div class="question-container" data-question-id="q10">
        <p class="question-text"><span class="question-number">12.</span> Regarding ureterocele all true except:</p>
        <ul class="options">
            <li class="option" data-correct="false">A. Rounded or elliptical dilatation of lower end of ureter with filling defect around it (Cobra head appearance).</li>
            <li class="option" data-correct="true">B. Congenital cystic dilatation of upper part of ureter.</li>
            <li class="option" data-correct="false">C. Associated with a Proximal dilatation of rest of ureter</li>
            <li class="option" data-correct="false">D. Filling defect could be noted in obstructed ureterocele.</li>
        </ul>
        <p class="explanation">
            Correct answer: B<br>
            a. Incorrect (this statement is true). The "cobra head" sign is classic for ureterocele.<br>
            b. Correct (this statement is false as required by "all true except"). A ureterocele is a dilatation of the distal, intravesical portion of the ureter.<br>
            c. Incorrect (this statement is true). Obstruction by a ureterocele can cause proximal dilatation.<br>
            d. Incorrect (this statement is true). The ureterocele itself can appear as a filling defect.
        </p>
    </div>

    <div class="question-container" data-question-id="q11">
        <p class="question-text"><span class="question-number">13.</span> Regarding genito-urinary emergencies all are true except:</p>
        <ul class="options">
            <li class="option" data-correct="false">A. C.T scan best imaging modality for diagnosis of pelvic wall fracture.</li>
            <li class="option" data-correct="true">B. C.T scan best imaging modality for diagnosis of testicular torsion.</li>
            <li class="option" data-correct="false">C. Ultrasound is the best imaging modality for diagnosis of ectopic pregnancy.</li>
            <li class="option" data-correct="false">D. Urethrogram for diagnosis of urethral injury.</li>
            <li class="option" data-correct="false">E. Cystogram for diagnosis of urinary bladder injury.</li>
        </ul>
        <p class="explanation">
            Correct answer: B<br>
            a. Incorrect (this statement is true). CT is highly sensitive for pelvic fractures.<br>
            b. Correct (this statement is false as required by "all true except"). Color Doppler Ultrasound is the modality of choice for testicular torsion.<br>
            c. Incorrect (this statement is true). Transvaginal ultrasound is primary for ectopic pregnancy.<br>
            d. Incorrect (this statement is true). Retrograde urethrography is standard for urethral injury.<br>
            e. Incorrect (this statement is true). CT cystography is used for bladder injury.
        </p>
    </div>

    <div class="question-container" data-question-id="q12">
        <p class="question-text"><span class="question-number">17.</span> Regarding ureteric stone , all are wrong except:</p>
        <ul class="options">
            <li class="option" data-correct="true">A. CT scan native is best imaging modality for diagnosis mid ureteric stone .</li>
            <li class="option" data-correct="false">B. Contrast needed for evaluation ureteric stone by CT scan .</li>
            <li class="option" data-correct="false">C. KUB is best imaging modality for evaluation ureteric stone .</li>
            <li class="option" data-correct="false">D. MRI is best imaging modality for evaluation ureteric stone .</li>
            <li class="option" data-correct="false">E. Ultrasound is highly accurate for visualization mid ureteric stone .</li>
        </ul>
        <p class="explanation">
            Correct answer: A<br>
            a. Correct (this statement is true). Non-contrast CT is gold standard for ureteric stones.<br>
            b. Incorrect (this statement is false). Non-contrast CT is preferred for stone detection.<br>
            c. Incorrect (this statement is false). KUB has limited sensitivity.<br>
            d. Incorrect (this statement is false). MRI is not primary for stone detection.<br>
            e. Incorrect (this statement is false). Mid-ureter is difficult to visualize with ultrasound.
        </p>
    </div>

    <div class="question-container" data-question-id="q13">
        <p class="question-text"><span class="question-number">29.</span> Regarding scrotal ultrasound ,chose incorrect answer:</p>
        <ul class="options">
            <li class="option" data-correct="false">A. extravaginal testicular torsion affects infants and is rare.</li>
            <li class="option" data-correct="true">B. in testicular torsion color doppler ultrasound there is markedly increased blood flow.</li>
            <li class="option" data-correct="false">C. multiple serpiginous tubules >2 mm in diameter superior and posterior to the testis is an ultrasound feature of varicocele.</li>
            <li class="option" data-correct="false">D. blood flow on doppler ultrasound of varicocele may be increased with coughing,rapid inspiration or valsava manoeuvre.</li>
            <li class="option" data-correct="false">E. varicocele related to the male factors infertility</li>
        </ul>
        <p class="explanation">
            Correct answer: B<br>
            a. Incorrect (this statement is largely true). Extravaginal torsion occurs in neonates/infants and is rare overall.<br>
            b. Correct (this statement is false as required by "chose incorrect answer"). Testicular torsion shows decreased or absent blood flow.<br>
            c. Incorrect (this statement is true). This describes a varicocele.<br>
            d. Incorrect (this statement is true). Valsalva can accentuate varicocele flow.<br>
            e. Incorrect (this statement is true). Varicocele is a cause of male infertility.
        </p>
    </div>

    <div class="section-score" id="score-section-2">Score: 0 / 13</div>
</div>

<div class="bottom-nav-container">
    <a href="#" class="main-button" id="home-button">
        <i class="fas fa-home"></i> Home
    </a>
    <button id="reset-button" class="main-button">
        <i class="fas fa-sync-alt"></i> Reset
    </button>
</div>

<script>
// ====== SUBJECT PAGE SHORTCUT LOGIC ======
const PAGE_ID = window.SUBJECT_SETTINGS.PAGE_ID;
const ANSWERS_KEY = `${PAGE_ID}_answers`;
const SCORES_KEY = `${PAGE_ID}_scores`;

// Set dynamic title and home button
document.title = window.SUBJECT_SETTINGS.PAGE_TITLE;
document.getElementById('dynamic-title')?.remove(); // Remove if exists
const homeBtn = document.getElementById('home-button');
if (homeBtn) homeBtn.href = window.SUBJECT_SETTINGS.HOME_LINK;

// ...rest of your script (no changes needed below this line)...
const sections = document.querySelectorAll('.section');
let sectionScores = {};

function saveState(sectionId, questionId, selectedOptionIndex, currentScore, totalQuestions) {
    let answers = JSON.parse(localStorage.getItem(ANSWERS_KEY)) || {};
    if (!answers[sectionId]) answers[sectionId] = {};
    answers[sectionId][questionId] = {
        selectedOptionIndex: selectedOptionIndex,
        answered: true
    };
    localStorage.setItem(ANSWERS_KEY, JSON.stringify(answers));

    let scores = JSON.parse(localStorage.getItem(SCORES_KEY)) || {};
    scores[sectionId] = { score: currentScore, total: totalQuestions };
    localStorage.setItem(SCORES_KEY, JSON.stringify(scores));
}

function applyOptionSelectionLogic(optionElement, questionContainer, isLoadTime = false) {
    const explanation = questionContainer.querySelector('.explanation');
    const allOptionsInQuestion = questionContainer.querySelectorAll('.option');
    const section = questionContainer.closest('.section');
    const sectionId = section.dataset.sectionId;
    const scoreDisplay = section.querySelector(`#score-section-${sectionId}`);
    const totalQuestionsInSection = section.querySelectorAll('.question-container').length;

    if (questionContainer.classList.contains('answered') && !isLoadTime) return;
    questionContainer.classList.add('answered');

    const isCorrect = optionElement.dataset.correct === 'true';

    let feedbackSpan = optionElement.querySelector('.feedback');
    if (!feedbackSpan) {
        feedbackSpan = document.createElement('span');
        feedbackSpan.className = 'feedback';
        optionElement.appendChild(feedbackSpan);
    }
    feedbackSpan.style.display = 'inline';

    if (isCorrect) {
        optionElement.classList.add('correct');
        feedbackSpan.textContent = ' ✓ Correct!';
        if (!isLoadTime) sectionScores[sectionId]++;
    } else {
        optionElement.classList.add('incorrect');
        feedbackSpan.textContent = ' ✗ Incorrect.';
        allOptionsInQuestion.forEach(opt => {
            if (opt.dataset.correct === 'true') {
                opt.classList.add('reveal-correct');
                let correctFeedback = opt.querySelector('.feedback');
                if (!correctFeedback) {
                    correctFeedback = document.createElement('span');
                    correctFeedback.className = 'feedback';
                    opt.appendChild(correctFeedback);
                }
                correctFeedback.textContent = ' ✓ Correct Answer';
                correctFeedback.style.display = 'inline';
            }
        });
    }

    if (explanation) explanation.style.display = 'block';
    allOptionsInQuestion.forEach(opt => { opt.style.cursor = 'default'; });

    if (scoreDisplay) {
        scoreDisplay.textContent = `Score: ${sectionScores[sectionId]} / ${totalQuestionsInSection}`;
    }

    if (!isLoadTime) {
        const optionIndex = Array.from(allOptionsInQuestion).indexOf(optionElement);
        saveState(sectionId, questionContainer.dataset.questionId, optionIndex, sectionScores[sectionId], totalQuestionsInSection);
    }
}

function loadState() {
    const savedAnswersData = JSON.parse(localStorage.getItem(ANSWERS_KEY));
    const savedScoresData = JSON.parse(localStorage.getItem(SCORES_KEY));

    sections.forEach(section => {
        const sectionId = section.dataset.sectionId;
        const totalQuestionsInSection = section.querySelectorAll('.question-container').length;
        sectionScores[sectionId] = (savedScoresData && savedScoresData[sectionId]) ? savedScoresData[sectionId].score : 0;

        const scoreDisplay = section.querySelector(`#score-section-${sectionId}`);
        if (scoreDisplay) {
            scoreDisplay.textContent = `Score: ${sectionScores[sectionId]} / ${totalQuestionsInSection}`;
        }

        if (savedAnswersData && savedAnswersData[sectionId]) {
            const questionsInSection = section.querySelectorAll('.question-container');
            questionsInSection.forEach(qc => {
                const questionId = qc.dataset.questionId;
                const qData = savedAnswersData[sectionId][questionId];
                if (qData && qData.answered && typeof qData.selectedOptionIndex === 'number') {
                    const optionsInQ = qc.querySelectorAll('.option');
                    const selectedOptionEl = optionsInQ[qData.selectedOptionIndex];
                    if (selectedOptionEl) {
                        applyOptionSelectionLogic(selectedOptionEl, qc, true);
                    }
                }
            });
        }
    });
}

function resetState() {
    localStorage.removeItem(ANSWERS_KEY);
    localStorage.removeItem(SCORES_KEY);

    sections.forEach(section => {
        const sectionId = section.dataset.sectionId;
        sectionScores[sectionId] = 0;
        const totalQuestionsInSection = section.querySelectorAll('.question-container').length;
        const scoreDisplay = section.querySelector(`#score-section-${sectionId}`);

        section.querySelectorAll('.question-container').forEach(qc => {
            qc.classList.remove('answered');
            const explanation = qc.querySelector('.explanation');
            if (explanation) explanation.style.display = 'none';

            qc.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect', 'reveal-correct');
                opt.style.cursor = 'pointer';
                const feedback = opt.querySelector('.feedback');
                if (feedback) {
                    feedback.textContent = '';
                    feedback.style.display = 'none';
                }
            });
        });

        if (scoreDisplay) {
            scoreDisplay.textContent = `Score: 0 / ${totalQuestionsInSection}`;
        }
    });
}

// Save total number of questions for summary use (main page)
document.addEventListener('DOMContentLoaded', function() {
    const totalQuestions = document.querySelectorAll('.question-container').length;
    let scores = JSON.parse(localStorage.getItem(SCORES_KEY)) || {};
    scores['all'] = scores['all'] || {};
    scores['all'].total = totalQuestions;
    localStorage.setItem(SCORES_KEY, JSON.stringify(scores));
});

document.addEventListener('DOMContentLoaded', () => {
    sections.forEach(section => {
        const sectionId = section.dataset.sectionId;
        sectionScores[sectionId] = 0;
    });

    loadState();

    sections.forEach(section => {
        const options = section.querySelectorAll('.option');
        options.forEach(option => {
            option.addEventListener('click', function() {
                const questionContainer = this.closest('.question-container');
                applyOptionSelectionLogic(this, questionContainer, false);
            });
        });
    });

    const resetButton = document.getElementById('reset-button');
    if (resetButton) {
        resetButton.addEventListener('click', resetState);
    }
});
</script>

</body>
</html>